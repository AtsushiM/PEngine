!function(){var g=void 0,k=null;function l(a){return function(){return this[a]}}var m=window,n=!0,p=!1,q={},r=p,s=/0/.test(function(){0})?/\b_super\b/:/.*/;Date.now||(Date.now=function(){return+new Date});function t(a,b){return Object.prototype.toString.call(b)=="[object "+a+"]"?n:p}function u(a){return t("Number",a)}function v(){}
v.extend=function(a,b,d){function c(){!r&&this.init&&this.init.apply(this,arguments)}function e(d){var e=a[d],w=b.prototype[d];t("Function",e)&&t("Function",w)&&s.test(e)?c.prototype[d]=function(){var a,b=this._super;this._super=w;a=e.apply(this,arguments);this._super=b;return a}:c.prototype[d]=e}b=this;r=n;c.prototype=new b;r=p;c.prototype.constructor=c;for(d in a)a.hasOwnProperty(d)&&e(d);c.extend=b.extend;return c};function x(a,b,d){a=a||v;a=a.extend(b);(d===g?p:n)&&(a.support=d);return a}
var B=x(k,{l:0,dispose:function(a,b,d){a=this;d=a.b;for(b in d)off.apply(k,d[b]);for(b in a)(d=a[b])&&d.dispose&&d.dispose();a.__proto__=k;for(b in a)a[b]=k,delete a[b]},contract:function(a,b,d,c,e){c=this;c.b||(c.b={});e=++c.l;on(a,b,d);c.b[e]=[a,b,d];return e},uncontract:function(a,b,d){a&&(b=this.b,d=b[a],delete b[a],off(d[0],d[1],d[2]))},init:function(){this.e={};this.d=[]},on:function(a,b,d,c){c=this.e;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b,d,c){d=this;c=function(){b.apply(d,arguments);
d.off(a,c)};c.q=b;d.on(a,c)},off:function(a,b,d,c,e,f){c=this.e;if(b){if(e=c[a])for(f=e.length;f--;)if(b==e[f]||b==e[f].q)return e.splice(f,1),0==e.length&&delete c[a],n;return p}return delete c[a]},emit:y,bubble:y,capture:function(){var a=arguments,b=this.d,d=b.length,c;if(p!==this.only.apply(this,a))for(;d--;)c=b[d],c.capture.apply(c,a)},only:function(){var a;a=[];a.push.apply(a,arguments);var b;b=a[0];t("String",b)&&(b={type:b,arguments:a,f:p,g:p,preventDefault:z,stopPropagation:A});b.before=b.target;
b.target=this;var d=this.e[b.type]||[],c,e=d.length;a.splice(0,1);for(a[a.length]=b;e--;)if(c=d[e])if(c=c.apply(this,a),c===p||b.f)return c;return b},addChild:function(a){a.a&&a.a.removeChild(a);a.a=this;this.d.push(a)},removeChild:function(a){var b=this.d,d=b.length;if(a)for(;d--;){if(b[d]===a){delete b[d].a;b.splice(d,1);break}}else for(;d--;){a=b;var c=d;delete a[c].a;a.splice(c,1)}}});function y(){var a=arguments,b=this.only.apply(this,a);if(p!==b&&!(b||q).g)(b=this.a)&&b.bubble.apply(b,a)}
function z(){this.f=n}function A(){this.g=n}
var E=x(B,{init:function(a){a=a||q;var b={engine:this};this._super();this.h=a.gravity||{x:0,y:9.80665E-4};this.n=a.sticky_threshold||4E-4;this.entities=[];this.c=[];this.p=new C(b);this.r=new D(b)},addEntity:function(a){this.entities.push(a)},removeEntity:function(a){this.k(this.entities,a)},addCollision:function(a){this.c.push(a)},removeCollision:function(a){this.k(this.c,a)},k:function(a,b){for(var d=a.length;d--;)if(a[d]===b){a.splice(d,1);break}},getEntities:l("entities"),getCollidables:l("c"),
step:function(a){for(var b=this.h.x*a,d=this.h.y*a,c,e=this.entities,f=e.length,h;f--;)c=e[f],c.vx+=c.ax*a+b,c.vy+=c.ay*a+d,c.x+=c.vx*a,c.y+=c.vy*a,h=this.p.detectCollisions(c,this.c),h!=k&&this.r.resolve(c,h),c.emit("step",h)}},g),F=x(B,{init:function(a){a=a||q;this._super();this.size(a);this.restitution=u(a.restitution)?a.restitution:0.2;this.y=this.x=0;this.position(a.position||q);this.vy=this.vx=0;this.velocity(a.velocity||q);this.ay=this.ax=0;this.acceleration(a.acceleration||q)},o:function(){this.j=
0.5*this.width;this.i=0.5*this.height},size:function(a){this.width=a.width;this.height=a.height;this.o()},position:function(a){u(a.x)&&(this.x=a.x);u(a.y)&&(this.y=a.y)},velocity:function(a){u(a.x)&&(this.vx=a.x);u(a.y)&&(this.vy=a.y)},acceleration:function(a){u(a.x)&&(this.ax=a.x);u(a.y)&&(this.ay=a.y)},getMidX:function(){return this.j+this.x},getMidY:function(){return this.i+this.y},getTop:l("y"),getLeft:l("x"),getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height}},
g),C=x(B,{detectCollisions:function(a,b){for(var d=[],c=b.length;c--;)this.collideRect(a,b[c])&&d.push(b[c]);return d.length?d:k},collideRect:function(a,b){return a.getBottom()<b.getTop()||a.getTop()>b.getBottom()||a.getRight()<b.getLeft()||a.getLeft()>b.getRight()?p:n}},g),D=x(B,{init:function(a){this._super();this.m=a.engine},resolve:function(a,b){for(var d=b.length;d--;)this.resolveElastic(a,b[d])},resolveElastic:function(a,b){var d=this.m.n,c=a.getMidX(),e=a.getMidY(),f=b.getMidX(),h=b.getMidY(),
c=(f-c)/b.j,e=(h-e)/b.i,h=Math.abs(c),f=Math.abs(e);0.1>Math.abs(h-f)?(a.x=0>c?b.getRight():b.getLeft()-a.width,a.y=0>e?b.getBottom():b.getTop()-a.height,0.5>Math.random()?(a.vx=-a.s*b.restitution,Math.abs(a.vx)<d&&(a.vx=0)):(a.vy=-a.vy*b.restitution,Math.abs(a.vy)<d&&(a.vy=0))):h>f?(a.x=0>c?b.getRight():b.getLeft()-a.width,a.vx=-a.s*b.restitution,Math.abs(a.vx)<d&&(a.vx=0)):(a.y=0>e?b.getBottom():b.getTop()-a.height,a.vy=-a.vy*b.restitution,Math.abs(a.vy)<d&&(a.vy=0))}},g),G={Entity:F,CollisionDetector:C,
CollisionResolver:D,Observer:B};for(g in G)E[g]=G[g];m.PE=E;}();
