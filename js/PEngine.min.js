!function(){var g=void 0,h=null,k=window,l=!0,m=!1,n={},p=m,q=/0/.test(function(){0})?/\b_super\b/:/.*/;Date.now||(Date.now=function(){return+new Date});function r(a,b){return Object.prototype.toString.call(b)=="[object "+a+"]"?l:m}function s(a){return r("Number",a)}function t(){}
t.extend=function(a,b,d){function c(){!p&&this.init&&this.init.apply(this,arguments)}function e(d){var e=a[d],w=b.prototype[d];r("Function",e)&&r("Function",w)&&q.test(e)?c.prototype[d]=function(){var a,b=this._super;this._super=w;a=e.apply(this,arguments);this._super=b;return a}:c.prototype[d]=e}b=this;p=l;c.prototype=new b;p=m;c.prototype.constructor=c;for(d in a)a.hasOwnProperty(d)&&e(d);c.extend=b.extend;return c};function v(a,b,d){a=a||t;a=a.extend(b);(d===g?m:l)&&(a.support=d);return a}
var A=v(h,{r:0,dispose:function(a,b,d){a=this;d=a.b;for(b in d)off.apply(h,d[b]);for(b in a)(d=a[b])&&d.dispose&&d.dispose();a.__proto__=h;for(b in a)a[b]=h,delete a[b]},contract:function(a,b,d,c,e){c=this;c.b||(c.b={});e=++c.r;on(a,b,d);c.b[e]=[a,b,d];return e},uncontract:function(a,b,d){a&&(b=this.b,d=b[a],delete b[a],off(d[0],d[1],d[2]))},init:function(){this.e={};this.d=[]},on:function(a,b,d,c){c=this.e;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b,d,c){d=this;c=function(){b.apply(d,arguments);
d.off(a,c)};c.v=b;d.on(a,c)},off:function(a,b,d,c,e,f){c=this.e;if(b){if(e=c[a])for(f=e.length;f--;)if(b==e[f]||b==e[f].v)return e.splice(f,1),0==e.length&&delete c[a],l;return m}return delete c[a]},fire:x,bubble:x,capture:function(){var a=arguments,b=this.d,d=b.length,c;if(m!==this.only.apply(this,a))for(;d--;)c=b[d],c.capture.apply(c,a)},only:function(){var a;a=[];a.push.apply(a,arguments);var b;b=a[0];r("String",b)&&(b={type:b,arguments:a,j:m,k:m,preventDefault:y,stopPropagation:z});b.before=b.target;
b.target=this;var d=this.e[b.type]||[],c,e=d.length;a.splice(0,1);for(a[a.length]=b;e--;)if(c=d[e])if(c=c.apply(this,a),c===m||b.j)return c;return b},addChild:function(a){a.a&&a.a.removeChild(a);a.a=this;this.d.push(a)},removeChild:function(a){var b=this.d,d=b.length;if(a)for(;d--;){if(b[d]===a){delete b[d].a;b.splice(d,1);break}}else for(;d--;){a=b;var c=d;delete a[c].a;a.splice(c,1)}}});function x(){var a=arguments,b=this.only.apply(this,a);if(m!==b&&!(b||n).k)(b=this.a)&&b.bubble.apply(b,a)}
function y(){this.j=l}function z(){this.k=l}
var E=v(A,{init:function(a){this._super();this.h=a.canvas;this.i=this.h.getContext("2d");a=document.defaultView.getComputedStyle(this.h,h);this.width=+a.width.replace(/[^0-9\.]/g,"");this.height=+a.height.replace(/[^0-9\.]/g,"");this.entities=[];this.f=[];this.u=new B;this.w=new C},addEntity:function(a){this.entities.push(a)},addCollision:function(a){this.f.push(a)},render:function(){this.i.clearRect(0,0,this.width,this.height);this.n(this.entities);this.n(this.f)},n:function(a){for(var b=a.length,
d,c=this.i;b--;)d=a[b],c.fillStyle="rgb(150,29,28)",c.fillRect(d.x,d.y,d.width,d.height)},step:function(a){for(var b=0*a,d=9.80665E-4*a,c,e=this.entities,f=e.length,u;f--;){c=e[f];switch(c.s){case D.g:c.vx+=c.ax*a+b;c.vy+=c.ay*a+d;c.x+=c.vx*a;c.y+=c.vy*a;break;case D.p:c.vx+=c.ax*a,c.vy+=c.ay*a,c.x+=c.vx*a,c.y+=c.vy*a}u=this.u.detectCollisions(c,this.f);u!=h&&this.w.resolve(c,u)}}},g),F={elastic:function(a){this.c=a||0.2},displace:function(){}},D=v(A,{init:function(a){a=a||n;this._super();this.s=
a.type||D.g;this.q=a.collisionName||D.o;this.size(a);F[this.q].call(this);this.y=this.x=0;this.position(a.position||n);this.vy=this.vx=0;this.velocity(a.velocity||n);this.ay=this.ax=0;this.acceleration(a.acceleration||n)},t:function(){this.m=0.5*this.width;this.l=0.5*this.height},size:function(a){this.width=a.width;this.height=a.height;this.t()},position:function(a){s(a.x)&&(this.x=a.x);s(a.y)&&(this.y=a.y)},velocity:function(a){s(a.x)&&(this.vx=a.x);s(a.y)&&(this.vy=a.y)},acceleration:function(a){s(a.x)&&
(this.ax=a.x);s(a.y)&&(this.ay=a.y)},getMidX:function(){return this.m+this.x},getMidY:function(){return this.l+this.y},getTop:function(){return this.y},getLeft:function(){return this.x},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height}},g);D.p="kinematic";D.g="dynamic";D.A="displace";D.o="elastic";
var B=v(A,{detectCollisions:function(a,b){for(var d=[],c=b.length;c--;)this.collideRect(a,b[c])&&d.push(b[c]);return d.length?d:h},collideRect:function(a,b){return a.getBottom()<b.getTop()||a.getTop()>b.getBottom()||a.getRight()<b.getLeft()||a.getLeft()>b.getRight()?m:l}},g),C=v(A,{resolve:function(a,b){for(var d=b.length;d--;)this.resolveElastic(a,b[d])},resolveElastic:function(a,b){var d=a.getMidX(),c=a.getMidY(),e=b.getMidX(),f=b.getMidY(),d=(e-d)/b.m,c=(f-c)/b.l,f=Math.abs(d),e=Math.abs(c);0.1>
Math.abs(f-e)?(a.x=0>d?b.getRight():b.getLeft()-a.width,a.y=0>c?b.getBottom():b.getTop()-a.height,0.5>Math.random()?(a.vx=-a.z*b.c,4E-4>Math.abs(a.vx)&&(a.vx=0)):(a.vy=-a.vy*b.c,4E-4>Math.abs(a.vy)&&(a.vy=0))):f>e?(a.x=0>d?b.getRight():b.getLeft()-a.width,a.vx=-a.z*b.c,4E-4>Math.abs(a.vx)&&(a.vx=0)):(a.y=0>c?b.getBottom():b.getTop()-a.height,a.vy=-a.vy*b.c,4E-4>Math.abs(a.vy)&&(a.vy=0))}},g),G={Entity:D,CollisionDetector:B,CollisionResolver:C,Observer:A};for(g in G)E[g]=G[g];k.PE=E;}();
