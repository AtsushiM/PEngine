!function(){var f=void 0,h=null;function l(a){return function(){return this[a]}}function m(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,c=b.length;d<c;d++)if(a===b[d])return d;return-1}function n(a,b){return Object.prototype.toString.call(b)=="[object "+a+"]"?p:q}function r(a){return n("Number",a)}function s(a,b,d){a.removeEventListener(b,d,q)}function t(a,b,d){a=a||u;a=a.extend(b);(d===f?q:p)&&(a.support=d);return a}
function v(){var a=arguments,b=this.only.apply(this,a);if(q!==b&&!(b||w).h)(b=this.b)&&b.bubble.apply(b,a)}function x(){this.g=p}function y(){this.h=p}var A=window,p=!0,q=!1,w={},B=q,C=/0/.test(function(){0})?/\b_super\b/:/.*/,u;u=function(){};
u.extend=function(a,b,d){function c(){!B&&this.init&&this.init.apply(this,arguments)}function e(d){var e=a[d],z=b.prototype[d];n("Function",e)&&n("Function",z)&&C.test(e)?c.prototype[d]=function(){var a,b=this._super;this._super=z;a=e.apply(this,arguments);this._super=b;return a}:c.prototype[d]=e}b=this;B=p;c.prototype=new b;B=q;c.prototype.constructor=c;for(d in a)a.hasOwnProperty(d)&&e(d);c.extend=b.extend;return c};
var D=t(h,{l:0,dispose:function(a,b,d){a=this;d=a.c;for(b in d)s.apply(h,d[b]);for(b in a)(d=a[b])&&d.dispose&&d.dispose();a.__proto__=h;for(b in a)a[b]=h,delete a[b]},contract:function(a,b,d,c,e){c=this;c.c||(c.c={});e=++c.l;a.addEventListener(b,d,q);c.c[e]=[a,b,d];return e},uncontract:function(a,b,d){a&&(b=this.c,d=b[a],delete b[a],s(d[0],d[1],d[2]))},init:function(){this.f={};this.e=[]},on:function(a,b,d,c){c=this.f;c[a]||(c[a]=[]);c[a].push(b)},one:function(a,b,d,c){d=this;c=function(){b.apply(d,
arguments);d.off(a,c)};c.q=b;d.on(a,c)},off:function(a,b,d,c,e,g){c=this.f;if(b){if(e=c[a])for(g=e.length;g--;)if(b==e[g]||b==e[g].q)return e.splice(g,1),0==e.length&&delete c[a],p;return q}return delete c[a]},emit:v,bubble:v,capture:function(){var a=arguments,b=this.e,d=b.length,c;if(q!==this.only.apply(this,a))for(;d--;)c=b[d],c.capture.apply(c,a)},only:function(){var a;a=[];a.push.apply(a,arguments);var b;b=a[0];n("String",b)&&(b={type:b,arguments:a,g:q,h:q,preventDefault:x,stopPropagation:y});
b.before=b.target;b.target=this;var d=this.f[b.type]||[],c,e=d.length;a.splice(0,1);for(a[a.length]=b;e--;)if(c=d[e])if(c=c.apply(this,a),c===q||b.g)return c;return b},addChild:function(a){a.b&&a.b.removeChild(a);a.b=this;this.e.push(a)},removeChild:function(a){var b=this.e,d=b.length;if(a)d=m(a,b),-1!==d&&(delete b[d].b,b.splice(d,1));else for(;d--;){a=b;var c=d;delete a[c].b;a.splice(c,1)}}}),G=t(D,{init:function(a){a=a||w;var b={engine:this};this._super();this.a=a.gravity;this.a.x=r(this.a.x)?
this.a.x:0;this.a.y=r(this.a.y)?this.a.y:9.80665E-4;this.n=a.sticky_threshold||4E-4;this.entities=[];this.d=[];this.p=new E(b);this.r=new F(b)},addEntity:function(a){this.entities.push(a)},removeEntity:function(a){this.k(this.entities,a)},addCollision:function(a){this.d.push(a)},removeCollision:function(a){this.k(this.d,a)},k:function(a,b){var d=m(b,a);-1!==d&&a.splice(d,1)},getEntities:l("entities"),getCollidables:l("d"),step:function(a){for(var b=this.a.x*a,d=this.a.y*a,c,e=this.entities,g=e.length,
k;g--;)c=e[g],c.vx+=c.ax*a+b,c.vy+=c.ay*a+d,c.x+=c.vx*a,c.y+=c.vy*a,k=this.p.detectCollisions(c,this.d),k!=h&&this.r.resolve(c,k),c.emit("step",k)}},f),H=t(D,{init:function(a){a=a||w;this._super();this.size(a);this.restitution=r(a.restitution)?a.restitution:0.2;this.y=this.x=0;this.position(a.position||w);this.vy=this.vx=0;this.velocity(a.velocity||w);this.ay=this.ax=0;this.acceleration(a.acceleration||w)},o:function(){this.j=0.5*this.width;this.i=0.5*this.height},size:function(a){this.width=a.width;
this.height=a.height;this.o()},position:function(a){r(a.x)&&(this.x=a.x);r(a.y)&&(this.y=a.y)},velocity:function(a){r(a.x)&&(this.vx=a.x);r(a.y)&&(this.vy=a.y)},acceleration:function(a){r(a.x)&&(this.ax=a.x);r(a.y)&&(this.ay=a.y)},getMidX:function(){return this.j+this.x},getMidY:function(){return this.i+this.y},getTop:l("y"),getLeft:l("x"),getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height}},f),E=t(D,{detectCollisions:function(a,b){for(var d=b.length,c;d--;)if(c=
b[d],a!==c&&this.collideRect(a,c))return c;return h},collideRect:function(a,b){return a.getBottom()<=b.getTop()||a.getTop()>=b.getBottom()||a.getRight()<=b.getLeft()||a.getLeft()>=b.getRight()?q:p}},f),F=t(D,{init:function(a){this._super();this.m=a.engine},resolve:function(a,b){var d=this.m.n,c=a.getMidX(),e=a.getMidY(),g=b.getMidX(),k=b.getMidY(),c=(g-c)/b.j,e=(k-e)/b.i,k=Math.abs(c),g=Math.abs(e);0.1>Math.abs(k-g)?(a.x=0>c?b.getRight():b.getLeft()-a.width,a.y=0>e?b.getBottom():b.getTop()-a.height,
0.5>Math.random()?(a.vx=-a.s*b.restitution,Math.abs(a.vx)<d&&(a.vx=0)):(a.vy=-a.vy*b.restitution,Math.abs(a.vy)<d&&(a.vy=0))):k>g?(a.x=0>c?b.getRight():b.getLeft()-a.width,a.vx=-a.s*b.restitution,Math.abs(a.vx)<d&&(a.vx=0)):(a.y=0>e?b.getBottom():b.getTop()-a.height,a.vy=-a.vy*b.restitution,Math.abs(a.vy)<d&&(a.vy=0))}},f),I={Entity:H,CollisionDetector:E,CollisionResolver:F,Observer:D};for(f in I)G[f]=I[f];A.PE=G;}();
