!function(){var f=void 0,k=null;function l(a){return function(){return this[a]}}var m=window,n=!0,p=!1,q={},r=p,s=/0/.test(function(){0})?/\b_super\b/:/.*/,t;function u(a,b){return Object.prototype.toString.call(b)=="[object "+a+"]"?n:p}function v(a){return u("Number",a)}function w(a,b,c){a.removeEventListener(b,c,p)}function x(a,b,c){a=a||t;a=a.extend(b);(c===f?p:n)&&(a.support=c);return a}function z(){var a=arguments,b=this.only.apply(this,a);if(p!==b&&!(b||q).g)(b=this.a)&&b.bubble.apply(b,a)}
function A(){this.f=n}function B(){this.g=n}Date.now||(Date.now=function(){return+new Date});t=function(){};
t.extend=function(a,b,c){function d(){!r&&this.init&&this.init.apply(this,arguments)}function e(c){var e=a[c],y=b.prototype[c];u("Function",e)&&u("Function",y)&&s.test(e)?d.prototype[c]=function(){var a,b=this._super;this._super=y;a=e.apply(this,arguments);this._super=b;return a}:d.prototype[c]=e}b=this;r=n;d.prototype=new b;r=p;d.prototype.constructor=d;for(c in a)a.hasOwnProperty(c)&&e(c);d.extend=b.extend;return d};
var C=x(k,{l:0,dispose:function(a,b,c){a=this;c=a.b;for(b in c)w.apply(k,c[b]);for(b in a)(c=a[b])&&c.dispose&&c.dispose();a.__proto__=k;for(b in a)a[b]=k,delete a[b]},contract:function(a,b,c,d,e){d=this;d.b||(d.b={});e=++d.l;a.addEventListener(b,c,p);d.b[e]=[a,b,c];return e},uncontract:function(a,b,c){a&&(b=this.b,c=b[a],delete b[a],w(c[0],c[1],c[2]))},init:function(){this.e={};this.d=[]},on:function(a,b,c,d){d=this.e;d[a]||(d[a]=[]);d[a].push(b)},one:function(a,b,c,d){c=this;d=function(){b.apply(c,
arguments);c.off(a,d)};d.q=b;c.on(a,d)},off:function(a,b,c,d,e,g){d=this.e;if(b){if(e=d[a])for(g=e.length;g--;)if(b==e[g]||b==e[g].q)return e.splice(g,1),0==e.length&&delete d[a],n;return p}return delete d[a]},emit:z,bubble:z,capture:function(){var a=arguments,b=this.d,c=b.length,d;if(p!==this.only.apply(this,a))for(;c--;)d=b[c],d.capture.apply(d,a)},only:function(){var a;a=[];a.push.apply(a,arguments);var b;b=a[0];u("String",b)&&(b={type:b,arguments:a,f:p,g:p,preventDefault:A,stopPropagation:B});
b.before=b.target;b.target=this;var c=this.e[b.type]||[],d,e=c.length;a.splice(0,1);for(a[a.length]=b;e--;)if(d=c[e])if(d=d.apply(this,a),d===p||b.f)return d;return b},addChild:function(a){a.a&&a.a.removeChild(a);a.a=this;this.d.push(a)},removeChild:function(a){var b=this.d,c=b.length;if(a)for(;c--;){if(b[c]===a){delete b[c].a;b.splice(c,1);break}}else for(;c--;){a=b;var d=c;delete a[d].a;a.splice(d,1)}}}),F=x(C,{init:function(a){a=a||q;var b={engine:this};this._super();this.h=a.gravity||{x:0,y:9.80665E-4};
this.n=a.sticky_threshold||4E-4;this.entities=[];this.c=[];this.p=new D(b);this.r=new E(b)},addEntity:function(a){this.entities.push(a)},removeEntity:function(a){this.k(this.entities,a)},addCollision:function(a){this.c.push(a)},removeCollision:function(a){this.k(this.c,a)},k:function(a,b){for(var c=a.length;c--;)if(a[c]===b){a.splice(c,1);break}},getEntities:l("entities"),getCollidables:l("c"),step:function(a){for(var b=this.h.x*a,c=this.h.y*a,d,e=this.entities,g=e.length,h;g--;)d=e[g],d.vx+=d.ax*
a+b,d.vy+=d.ay*a+c,d.x+=d.vx*a,d.y+=d.vy*a,h=this.p.detectCollisions(d,this.c),h!=k&&this.r.resolve(d,h),d.emit("step",h)}},f),G=x(C,{init:function(a){a=a||q;this._super();this.size(a);this.restitution=v(a.restitution)?a.restitution:0.2;this.y=this.x=0;this.position(a.position||q);this.vy=this.vx=0;this.velocity(a.velocity||q);this.ay=this.ax=0;this.acceleration(a.acceleration||q)},o:function(){this.j=0.5*this.width;this.i=0.5*this.height},size:function(a){this.width=a.width;this.height=a.height;
this.o()},position:function(a){v(a.x)&&(this.x=a.x);v(a.y)&&(this.y=a.y)},velocity:function(a){v(a.x)&&(this.vx=a.x);v(a.y)&&(this.vy=a.y)},acceleration:function(a){v(a.x)&&(this.ax=a.x);v(a.y)&&(this.ay=a.y)},getMidX:function(){return this.j+this.x},getMidY:function(){return this.i+this.y},getTop:l("y"),getLeft:l("x"),getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height}},f),D=x(C,{detectCollisions:function(a,b){for(var c=b.length;c--;)if(a!==b[c]&&this.collideRect(a,
b[c]))return b[c];return k},collideRect:function(a,b){return a.getBottom()<=b.getTop()||a.getTop()>=b.getBottom()||a.getRight()<=b.getLeft()||a.getLeft()>=b.getRight()?p:n}},f),E=x(C,{init:function(a){this._super();this.m=a.engine},resolve:function(a,b){var c=this.m.n,d=a.getMidX(),e=a.getMidY(),g=b.getMidX(),h=b.getMidY(),d=(g-d)/b.j,e=(h-e)/b.i,h=Math.abs(d),g=Math.abs(e);0.1>Math.abs(h-g)?(a.x=0>d?b.getRight():b.getLeft()-a.width,a.y=0>e?b.getBottom():b.getTop()-a.height,0.5>Math.random()?(a.vx=
-a.s*b.restitution,Math.abs(a.vx)<c&&(a.vx=0)):(a.vy=-a.vy*b.restitution,Math.abs(a.vy)<c&&(a.vy=0))):h>g?(a.x=0>d?b.getRight():b.getLeft()-a.width,a.vx=-a.s*b.restitution,Math.abs(a.vx)<c&&(a.vx=0)):(a.y=0>e?b.getBottom():b.getTop()-a.height,a.vy=-a.vy*b.restitution,Math.abs(a.vy)<c&&(a.vy=0))}},f),H={Entity:G,CollisionDetector:D,CollisionResolver:E,Observer:C};for(f in H)F[f]=H[f];m.PE=F;}();
